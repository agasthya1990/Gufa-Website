<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GUFA Admin</title>

  <!-- Primary stylesheet (absolute path so it works from anywhere) -->
  <link rel="stylesheet" href="/admin/style.admin.css" />

  <!-- Minimal inline styles to ensure tabs look fine even if the CSS file is not yet deployed -->
  <style>
    /* Tabs */
    .adm-tabs { display:flex; gap:10px; border-bottom:1px solid #e5e7eb; margin:16px 0; flex-wrap:wrap; }
    .adm-tablink {
      appearance:none; border:0; background:transparent; padding:10px 12px; cursor:pointer; 
      font-weight:700; border-bottom:3px solid transparent;
    }
    .adm-tablink.is-active { border-color:#2563eb; color:#2563eb; }
    .adm-tabpanel { display:none; gap:12px; }
    .adm-tabpanel.is-active { display:block; }

    /* Keep native selects hidden (custom dropdowns render next to them) */
    #itemCategory, #foodCourse, #addonsSelect {
      position:absolute !important; left:-9999px !important; width:1px !important; height:1px !important; opacity:0 !important;
    }

    /* Category/Course/Add-on list rows */
    .cat-row, .course-row, .addon-row { display:flex; align-items:center; gap:8px; padding:6px 4px; border-radius:6px; }
    .cat-row:hover, .course-row:hover, .addon-row:hover { background:#f7f7f7; }
    .cat-check, .course-check, .addon-check {
      width:16px; height:16px; border:1px solid #aaa; border-radius:3px; display:inline-block; position:relative; cursor:pointer;
    }
    .cat-check.checked::after, .course-check.checked::after, .addon-check.checked::after {
      content:""; position:absolute; left:3px; top:1px; width:8px; height:12px; border-right:2px solid #222; border-bottom:2px solid #222; transform:rotate(45deg);
    }
    .cat-label, .course-label, .addon-label { flex:1; cursor:pointer; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .cat-btn, .course-btn, .addon-btn { background:none; border:none; cursor:pointer; font-size:14px; }
    .inline-controls { display:flex; align-items:center; gap:8px; width:100%; }

    .dropdown-wrap { position:relative; display:inline-block; margin-left:8px; }
    .dropdown-panel { display:none; position:absolute; z-index:10; background:#fff; border:1px solid #ddd; border-radius:6px; padding:8px; min-width:240px; max-height:240px; overflow:auto; }
  </style>
</head>
<body>
  <!-- Login -->
  <h2>Admin Login</h2>
  <div id="loginBox" class="adm-card" style="max-width:520px">
    <label for="email">Email</label>
    <input
      type="email"
      id="email"
      name="username"
      autocomplete="username"
      autocapitalize="none"
      autocorrect="off"
      class="adm-input"
      placeholder="you@company.com"
      required
    />
    <label for="password" style="margin-top:8px; display:block;">Password</label>
    <input
      type="password"
      id="password"
      name="current-password"
      autocomplete="current-password"
      class="adm-input"
      placeholder="••••••••"
      required
    />
    <div class="adm-row" style="justify-content:flex-end; margin-top:10px">
      <button id="loginBtn" type="button" class="adm-btn adm-btn--primary">Login</button>
    </div>
  </div>

  <!-- App -->
  <div id="adminContent" style="display:none;">
    <div class="adm-row" style="justify-content:space-between; align-items:center;">
      <h3>GUFA — Admin Panel</h3>
      <button id="logoutBtn" class="adm-btn">Logout</button>
    </div>

    <!-- Tabs -->
    <nav class="adm-tabs" role="tablist" aria-label="Admin sections">
      <button class="adm-tablink is-active" data-tab="menu" aria-selected="true">Menu</button>
      <button class="adm-tablink" data-tab="orders" aria-selected="false">Orders</button>
      <button class="adm-tablink" data-tab="promotions" aria-selected="false">Promotions</button>
      <button class="adm-tablink" data-tab="payments" aria-selected="false">Payments</button>
      <button class="adm-tablink" data-tab="deliveries" aria-selected="false">Deliveries</button>
    </nav>

    <!-- Panel: Menu -->
    <section id="panel-menu" class="adm-tabpanel is-active" role="tabpanel" aria-labelledby="tab-menu">
      <h3>Add New Menu Item</h3>
      <form id="menuForm" class="adm-card adm-form-grid">
        <input type="text" id="itemName" class="adm-input full" autocomplete="off" placeholder="Item Name" required />
        <input type="text" id="itemDescription" class="adm-input full" autocomplete="off" placeholder="Description" required />

        <!-- Category (hidden select + custom dropdown) -->
        <div class="full">
          <select id="itemCategory" required>
            <option value="">-- Select Category --</option>
          </select>
          <div class="dropdown-wrap">
            <button type="button" id="categoryDropdownBtn" class="adm-btn">Select Category ▾</button>
            <div id="categoryDropdownPanel" class="dropdown-panel"><!-- injected --></div>
          </div>
          <div class="adm-row" style="margin-top:8px">
            <input type="text" id="newCategoryInput" class="adm-input adm-grow" autocomplete="off" placeholder="Add New Category" />
            <button type="button" id="addCategoryBtn" class="adm-btn">Add Category</button>
          </div>
        </div>

        <!-- Food Course -->
        <div class="full">
          <select id="foodCourse" required>
            <option value="">-- Select Food Course --</option>
          </select>
          <div class="dropdown-wrap">
            <button type="button" id="courseDropdownBtn" class="adm-btn">Select Course ▾</button>
            <div id="courseDropdownPanel" class="dropdown-panel"><!-- injected --></div>
          </div>
          <div class="adm-row" style="margin-top:8px">
            <input type="text" id="newCourseInput" class="adm-input adm-grow" autocomplete="off" placeholder="Add New Food Course" />
            <button type="button" id="addCourseBtn" class="adm-btn">Add Course</button>
          </div>
        </div>

        <!-- Add-ons -->
<div class="full">
  <select id="addonsSelect" multiple></select>
  <div class="dropdown-wrap">
    <button type="button" id="addonDropdownBtn" class="adm-btn">Select Add-ons ▾</button>
    <div id="addonDropdownPanel" class="dropdown-panel"><!-- injected --></div>
  </div>
  <div class="adm-row" style="margin-top:8px">
    <input type="text" id="newAddonInput" class="adm-input adm-grow" autocomplete="off" placeholder="Add New Add-on" />
    <input type="number" id="newAddonPrice" class="adm-input" placeholder="Price (₹)" style="width:120px;" />
    <button type="button" id="addAddonBtn" class="adm-btn">Add Add-on</button>
  </div>
</div>
        <!-- Food Type -->
        <div>
          <label>Food Type</label>
          <select id="foodType" class="adm-select" required>
            <option value="">-- Select Food Type --</option>
            <option value="Veg">Veg</option>
            <option value="Non-Veg">Non-Veg</option>
          </select>
        </div>

        <!-- Quantity Type -->
        <div>
          <label>Quantity Type</label>
          <select id="qtyType" class="adm-select" required>
            <option value="">-- Select Qty Type --</option>
            <option value="Not Applicable">Not Applicable</option>
            <option value="Half & Full">Half & Full</option>
          </select>
        </div>

        <input type="number" id="itemPrice" class="adm-input" autocomplete="off" placeholder="Price" style="display:none;" />
        <input type="number" id="halfPrice" class="adm-input" autocomplete="off" placeholder="Half Price" style="display:none;" />
        <input type="number" id="fullPrice" class="adm-input" autocomplete="off" placeholder="Full Price" style="display:none;" />

        <!-- Image Upload -->
        <div class="full">
          <label>Image</label>
          <input type="file" id="itemImage" class="adm-file" accept="image/*" required />
        </div>

        <div class="full" style="text-align:right">
          <button type="submit" class="adm-btn adm-btn--primary">Add Menu Item</button>
        </div>
      </form>

      <h3>Search & Filters</h3>
      <div class="adm-card adm-row">
        <input type="text" id="searchInput" name="searchInput" aria-label="Search menu items"
       class="adm-input" placeholder="Search by name, description, category..." />
        <select id="filterCategory" name="filterCategory" aria-label="Filter by category"
        class="adm-select"><option value="">All Categories</option></select>
        <select id="filterCourse" name="filterCourse" aria-label="Filter by course"
        class="adm-select"><option value="">All Courses</option></select>

        <select id="filterType" name="filterType" aria-label="Filter by type"
         class="adm-select">
         <option value="">All Types</option>
         <option value="Veg">Veg</option>
         <option value="Non-Veg">Non-Veg</option>
         </select>
      </div>

      <h3>Menu Items</h3>
      <div class="adm-card">
        <table class="adm-table" id="menuTable">
          <thead>
            <tr>
              <!-- select-all checkbox header will be injected by admin.js -->
              <th>Name</th>
              <th>Description</th>
              <th>Category</th>
              <th>Food Course</th>
              <th>Food Type</th>
              <th>Qty Type</th>
              <th>Price(s)</th>
              <th>Add-ons</th>
              <th>Promotions</th>
              <th>Image</th>
              <th>In Stock</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="menuBody"></tbody>
        </table>
        <p id="statusMsg" class="adm-muted" style="margin-top:8px"></p>
      </div>
    </section>

    <!-- Panel: Orders -->
    <section id="panel-orders" class="adm-tabpanel" role="tabpanel" aria-labelledby="tab-orders">
      <div id="ordersRoot" class="adm-card"><!-- orders.js will render here --></div>
    </section>

    <!-- Panel: Promotions -->
    <section id="panel-promotions" class="adm-tabpanel" role="tabpanel" aria-labelledby="tab-promotions">
      <div id="promotionsRoot" class="adm-card"><!-- promotions.js will render here --></div>
    </section>

    <!-- Panel: Payments -->
    <section id="panel-payments" class="adm-tabpanel" role="tabpanel" aria-labelledby="tab-payments">
      <div id="paymentsRoot" class="adm-card"><!-- paymentgateway.js will render here --></div>
    </section>

    <!-- Panel: Deliveries -->
    <section id="panel-deliveries" class="adm-tabpanel" role="tabpanel" aria-labelledby="tab-deliveries">
      <div id="deliveriesRoot" class="adm-card"><!-- deliverytracking.js will render here --></div>
    </section>
  </div>

  <!-- Edit Modal (used by admin.js) -->
  <div id="editModal" class="adm-modal">
    <div class="adm-modal__dialog" style="max-width:640px">
      <div class="adm-modal__head">
        <strong>Edit Menu Item</strong>
        <button type="button" id="closeEditModal" class="adm-btn adm-btn--ghost">Close</button>
      </div>
      <div class="adm-modal__body">
        <form id="editForm" class="adm-form-grid">
          <input type="text" id="editName" class="adm-input full" required />
          <input type="text" id="editDescription" class="adm-input full" required />
          <select id="editCategory" class="adm-select"></select>
          <select id="editCourse" class="adm-select"></select>
          <select id="editType" class="adm-select">
            <option value="Veg">Veg</option>
            <option value="Non-Veg">Non-Veg</option>
          </select>
          <select id="editQtyType" class="adm-select">
            <option value="Not Applicable">Not Applicable</option>
            <option value="Half & Full">Half & Full</option>
          </select>
          <input type="number" id="editItemPrice" class="adm-input" style="display:none;" />
          <input type="number" id="editHalfPrice" class="adm-input" style="display:none;" />
          <input type="number" id="editFullPrice" class="adm-input" style="display:none;" />
          <input type="file" id="editImage" class="adm-file full" accept="image/*" />
        </form>
      </div>
      <div class="adm-modal__foot">
        <button type="submit" form="editForm" class="adm-btn adm-btn--primary">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Tab switcher (small + isolated) -->
  <script>
    (function(){
      function showTab(key){
        document.querySelectorAll('.adm-tablink').forEach(b=>{
          const on = b.dataset.tab === key;
          b.classList.toggle('is-active', on);
          b.setAttribute('aria-selected', on ? 'true' : 'false');
        });
        document.querySelectorAll('.adm-tabpanel').forEach(p=>{
          p.classList.toggle('is-active', p.id === 'panel-' + key);
        });
        try { localStorage.setItem('adm.tab', key); } catch(e){}
      }
      document.addEventListener('click', (e)=>{
        const btn = e.target.closest('.adm-tablink'); if (!btn) return;
        showTab(btn.dataset.tab);
      });
      // Restore last tab (default to menu)
      const last = (function(){ try { return localStorage.getItem('adm.tab') || 'menu'; } catch(e){ return 'menu'; } })();
      showTab(last);
    })();
  </script>

  <!-- App scripts (absolute paths) -->
  <script type="module" src="/admin/firebase.js"></script>
  <script type="module" src="/admin/admin.js"></script>
  <script type="module" src="/admin/orders.js"></script>
  <script type="module" src="/admin/promotions.js"></script>
  <script type="module" src="/admin/paymentgateway.js"></script>
  <script type="module" src="/admin/deliverytracking.js"></script>
</body>
</html>
