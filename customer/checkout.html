<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Checkout</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; }
    header { display:flex; align-items:center; gap:12px; padding:12px 16px; border-bottom:1px solid #eee; }
    header .cart-badge-wrap { margin-left:auto; }
    main.checkout { display:grid; grid-template-columns: 1fr 320px; gap:24px; padding:16px; }
    @media (max-width: 900px) { main.checkout { grid-template-columns: 1fr; } }

    #cart-items { list-style:none; padding:0; margin:0; }
    .cart-row { display:grid; grid-template-columns: 64px 1fr auto; gap:10px; padding:12px 0; border-bottom:1px solid #eee; }
    .grouped .addon-list { padding:6px 0 0 74px; display:grid; row-gap:6px; }
    .addon-row { display:flex; justify-content:space-between; align-items:center; }
    .addon-label.muted { color:#666; }
    .row-right { display:flex; gap:10px; align-items:center; }
    .stepper { display:flex; gap:6px; align-items:center; }
    .stepper.sm button { width:24px; height:24px; }
    .stepper button { width:28px; height:28px; }
    .line-subtotal { min-width:72px; text-align:right; }
    .card-thumb { width:64px; height:64px; object-fit:cover; border-radius:8px; background:#f5f5f5; }
    .cart-title { margin:0 0 4px; font-size:16px; }
    .cart-sub { margin:0; color:#666; font-size:13px; }
    .remove-link { background:none; border:1px solid #ddd; padding:6px 10px; border-radius:8px; }
    .empty { color:#777; padding:10px 0; }

    aside.cart-right { border:1px solid #eee; border-radius:12px; padding:12px; height:max-content; }
    .totals { display:grid; row-gap:6px; margin-top:8px; }
    .total-row { display:flex; justify-content:space-between; }
    .total-row.promo-row { color:#b00020; }
    #proceed-btn { margin-top:10px; width:100%; padding:10px 12px; border-radius:10px; border:none; background:#111; color:#fff; }
    #proceed-btn:disabled { opacity:0.5; }
    .muted { color:#666; }
  </style>

  <!-- HYDRATE FROM ?cart= → single-key FLAT 'gufa_cart' (accepts flat or {items:{}} input) -->
  <script>
  (function () {
    function fromBase64Url(s) {
      s = s.replace(/-/g, '+').replace(/_/g, '/'); while (s.length % 4) s += '=';
      return atob(s);
    }
    const qs = new URLSearchParams(location.search);
    const blob = qs.get('cart');
    if (blob && !localStorage.getItem('gufa_cart')) {
      try {
        const json = JSON.parse(fromBase64Url(blob));
        const bag = (json && typeof json === 'object')
          ? (json.items && typeof json.items === 'object' ? json.items : json)
          : {};
        localStorage.setItem('gufa_cart', JSON.stringify(bag));
      } catch {}
    }
  })();
  </script>

  <!-- Expose selectors for the cart script (list layout) -->
  <script>
    window.CART_UI = {
      list: {
        items:'#cart-items',
        empty:'#cart-empty',
        count:'#cart-items-count',
        addonsNote:'#addons-note',
        subtotal:'#subtotal-amt',
        servicetax:'#servicetax-amt',
        total:'#total-amt',
        proceed:'#proceed-btn'
      },
      table: { body:'#cartBody', total:'#cartTotal' } // optional fallback
    };
  </script>
</head>
<body>

  <header>
    <a href="/customer/menu" id="back-link">← Menu</a>
    <div class="cart-badge-wrap">Cart: <span id="cart-count">0</span></div>
  </header>

  <main class="checkout">
    <section class="cart-left">
      <ul id="cart-items"></ul>
      <div id="cart-empty" class="empty">Your cart is empty.</div>
      <div id="addons-note" class="muted" style="margin-top:8px;"></div>
    </section>

    <aside class="cart-right">
      <div id="cart-items-count" class="muted">(0 items)</div>
      <div class="totals">
        <div class="total-row"><span>Subtotal</span><span id="subtotal-amt">₹0</span></div>
        <div class="total-row"><span>Service Tax</span><span id="servicetax-amt">₹0</span></div>
        <div class="total-row" style="font-weight:700;"><span>Total</span><span id="total-amt">₹0</span></div>
      </div>
      <button id="proceed-btn" disabled>Proceed</button>
    </aside>
  </main>

  <!-- Load order: store first, then cart UI -->
  <script src="./cart.store.js"></script>
  <script src="./app.cart.js"></script>
</body>
</html>
